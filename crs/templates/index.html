<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>CRS Frontend </title>

<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script type=text/javascript>
  $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
</script>

<input type="hidden" id="refreshed" value="no">
<script type="text/javascript">


var ihandle=setInterval(function(){
   update();
}, 3000);

</script>
<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
.tg th{font-family:Arial, sans-serif;font-size:12px;font-weight:normal;padding:2px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
.tg .tg-9wi7{font-weight:bold;font-size:12px;background-color:#fffc9e;text-align:center}
.tg .tg-kr94{font-size:12px;text-align:center}
.tg .tg-k6pi{font-size:12px}
</style>
    
</head>

<body>
    <img src="http://www.harness-project.eu/wp-content/uploads/2013/03/LOGO.png" alt="Logo" height="100" style="max-width: 120px;"\>
    <h1>CRS Frontend (v3) </h1>
    
<script>	
	function update() {
		var request = $.ajax({
			url: $SCRIPT_ROOT + "/status/data",
			type: "GET",			
			dataType: "json",
			success: function(data) {
			   var sect_resources = $("#resources").empty();
			   var managers = data["result"]["managers"];
			   var resources = data["result"]["resources"];
			   var reservations = data["result"]["reservations"];
			   var n = 1;
			   if (Object.keys(managers).length == 0) {
			      $("<h4>No IRMs have been registered!</h4>").appendTo(sect_resources);
			   } else {
			      $.each(managers, function(i, v) {
			         var hdr = $("<h5>").appendTo(sect_resources);
			         hdr.append(n + ". " + v["Name"] + " (" + v["Address"] + ": " + 
			                    v["Port"] + " / " + v["ManagerID"] + ")");
			         var table = $("<table class='tg'>").appendTo(sect_resources);
			         $("<tr><th class='tg-9wi7'>ID</th>" +
			           "<th class='tg-9wi7'>Type</th>"   +
			           "<th class='tg-9wi7'>Attributes</th></tr>").appendTo(table);
                  $.each(resources[i], function(j, r) {
    			         $("<tr><th class='tg-kr94'>" + j + "</th>" +
			              "<th class='tg-kr94'>" + r['Type'] + "</th>"   +
			              "<th class='tg-kr94'>" + JSON.stringify(r['Attributes']) + "</th></tr>")
			              .appendTo(table); 
			         });                
			         n++;
			      });
			  }
			  
			  var sect_reservations = $("#reservations").empty();
			  if (Object.keys(reservations).length == 0) {
			      $("<h4>No reservations!</h4>").appendTo(sect_reservations);
			  } else {		
			      var list = $("<ol>").appendTo(sect_reservations);
			      for (res in reservations) {
			         $("<li>" + JSON.stringify(reservations[res]) + "</li>").appendTo(list);
               }			  
			  }

        }
			  
			
		});

		request.fail(function(jqXHR, textStatus) {
		   clearInterval(ihandle);
			alert( "Request failed: " + textStatus );
		});
	}
</script>


<script>	
	function reset() {
		var request = $.ajax({
			url: $SCRIPT_ROOT + "/v3/managers",
			type: "DELETE",			
			dataType: "json",
			success: function(data) {
			   update();
			  }
			});

		request.fail(function(jqXHR, textStatus) {
			alert( "Request failed: " + textStatus );
		});
	}
</script>

<script>	
	function refresh() {
		var request = $.ajax({
			url: $SCRIPT_ROOT + "/v3/resources/request",
			type: "POST",			
			dataType: "json",
			success: function(data) {
			   update();
			  }
			});

		request.fail(function(jqXHR, textStatus) {
			alert( "Request failed: " + textStatus );
		});
	}
</script>


<input type="button" value="Refresh" onClick="refresh()"</button> 
<input type="button" value="Reboot" onClick="reset()"</button>  
  
<hr>
<h3>Resources</h3>
<div id="resources"></div>
<hr>
<h3>Reservations</h3>
<div id="reservations"></div>
<hr> 
</body>
</html>
